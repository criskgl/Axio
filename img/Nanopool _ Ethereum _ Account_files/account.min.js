ko.bindingHandlers["reset"]={init:function(element,valueAccessor,allBindings,viewModel,bindingContext){if(typeof valueAccessor()!=="function")throw new Error("The value for a reset binding must be a function");ko.utils.registerEventHandler(element,"reset",function(event){var handlerReturnValue;var value=valueAccessor();try{handlerReturnValue=value.call(bindingContext["$data"],element)}finally{if(handlerReturnValue!==true){if(event.preventDefault)event.preventDefault();else event.returnValue=false}}})}};function Worker(id,hashrate,last_share,last_share_is_old,rating){var self=this;self.id=id;self.hashrateValue=ko.observable(hashrate);self.last_share=ko.observable(last_share);self.last_share_is_old=ko.observable(last_share_is_old);self.avg_hashrate=ko.observable(0);self.reported_hashrate=ko.observable(0);self.rating=ko.observable(rating);self.hashrate=ko.observable(new BigNumber(self.hashrateValue()).toFormat(config.hashratePrecision))}function UserData(){var self=this;self.text=ko.observable("")}function Payment(txHash,date,amount,confirmed,extra){var self=this;self.txHash=ko.observable(txHash);self.amount=ko.observable(amount);self.confirmed=ko.observable(confirmed);self.extra=ko.observable(extra);self.date=ko.observable(date)}function Payments(){var self=this;self.maxSize=ko.observable(10);self.numPerPage=ko.observable(50);self.currentPage=ko.observable(1);self.totalPayments=ko.observable(0);self.total_paid=ko.observable(0);self.payments=ko.observableArray([])}function UserSettings(address,parent){var self=this;self.parent=parent;self.successMessage=ko.observable("");self.errorMessage=ko.observable("");self.min_payout=ko.observable();self.current_min_payout=ko.observable();self.current_pubkey=ko.observable();self.balance=ko.observable();self.pubkey=ko.observable();self.password=ko.observable("");self.address=ko.observable(address);self.processing=ko.observable(false);self.forcePayout=function(){var url=apiUrl+"/force_payout/"+self.address();if(self.password().length===0){self.errorMessage("Password can not be empty");return}if(self.password().length<6){self.errorMessage("Password too short");self.processing(false);return}var data={};data.password=self.password();$.ajax({type:"POST",url:url,data:data,crossDomain:true,dataType:"json"}).done(function(data){self.processing(false);if(data.status===false){self.errorMessage(data.error)}else{self.successMessage("Payout request accepted")}}).fail(function(xhr,textStatus,errorThrown){self.processing(false);self.errorMessage("Internal server error")})};self.resetUserSettings=function(){self.min_payout("");self.pubkey("");self.password("");return false};self.changeUserSettings=function(){self.processing(true);self.errorMessage("");self.successMessage("");var url=apiUrl+"/change_settings/"+self.address();var data={};if(self.password().length===0){self.errorMessage("Password can not be empty");self.processing(false);return}if(self.password().length<6){self.errorMessage("Password too short");self.processing(false);return}if(self.min_payout()!==0&&self.min_payout()!==undefined){if(self.min_payout()<config.minPayoutFrom||self.min_payout()>config.minPayoutTo){self.errorMessage("Minimum payout must be less then "+config.minPayoutTo+" and greater then "+config.minPayoutFrom);self.processing(false);return}data.min_payout=self.min_payout()}if(self.pubkey()!==undefined&&self.pubkey()!==null&&self.pubkey().length>0){if(self.pubkey().length!==102&&self.pubkey().length!==140&&self.pubkey().length!==192){self.errorMessage("Public key must contain 102, 140 or 192 characters(only letters and digits are allowed)");self.processing(false);return}data.pubkey=self.pubkey()}data.password=self.password();if(Object.keys(data).length<=1){self.errorMessage("Change some settings");self.processing(false);return}$.ajax({type:"POST",url:url,data:data,crossDomain:true,dataType:"json"}).done(function(data){self.processing(false);if(data.status===false){self.errorMessage(data.error)}else{self.successMessage("Settings successfully changed");if(data.data.min_payout!==undefined){self.current_min_payout(self.min_payout());self.parent.min_payout(self.min_payout())}if(data.data.pubkey!==undefined){self.current_pubkey(self.pubkey())}}}).fail(function(xhr,textStatus,errorThrown){self.processing(false);self.errorMessage("Internal server error")})}}function getUserSettings(originAddress,callback){request("/usersettings/"+originAddress,30,function(data){if(data===null){callback(config.minPayout)}else{callback(data.payout,data.pubkey)}})}function CalcValues(){var self=this;self.coins=ko.observable("0.0");self.bitcoins=ko.observable("0.0");self.dollars=ko.observable("0.0");self.yuan=ko.observable("0.0");self.euros=ko.observable("0.0");self.rubles=ko.observable("0.0")}CalcValues.prototype.setValues=function(data){var self=this;self.coins(new BigNumber(data.coins).toFormat(config.coinCalcSigns));self.bitcoins(new BigNumber(data.bitcoins).toFormat(config.btcCalcSigns));self.dollars(new BigNumber(data.dollars).toFormat(config.usdCalcSigns));self.yuan(new BigNumber(data.yuan).toFormat(config.usdCalcSigns));self.euros(new BigNumber(data.euros).toFormat(config.usdCalcSigns));self.rubles(new BigNumber(data.rubles).toFormat(config.usdCalcSigns))};function Calc(){var self=this;self.minute=ko.observable(new CalcValues);self.hour=ko.observable(new CalcValues);self.day=ko.observable(new CalcValues);self.week=ko.observable(new CalcValues);self.month=ko.observable(new CalcValues)}Calc.prototype.setValues=function(data){var self=this;self.minute().setValues(data.minute);self.hour().setValues(data.hour);self.day().setValues(data.day);self.week().setValues(data.week);self.month().setValues(data.month)};AccountViewModel.prototype.checkWorkerName=function(worker){var self=this;var valid=/^[0-9a-zA-Z_\-]+$/.test(worker);if(!valid){self.badWorkerName("Worker name must contain only numbers, letters, underscores, and dashes.")}};AccountViewModel.prototype.parseAddress=function(){var self=this;var pathArray=window.location.pathname.split("/");self._address=pathArray[2];self._originAddress=self._address;if(config.shortNameUpper==="ETH"||config.shortNameUpper==="ETC"||config.shortNameUpper==="SIA")self._originAddress=self._originAddress.toLowerCase();self._workerUrl="";if(pathArray.length>3&&pathArray[3].length>0){var worker=pathArray[3];self.worker(worker);self._workerUrl="/"+worker;self.workerPage(true);self.checkWorkerName(worker)}};AccountViewModel.prototype.init=function(){var self=this;self.workerPage=ko.observable(false);self.show_offline_workers=ko.observable(true);self.worker=ko.observable("");self.hashrate=ko.observable(0);self.balance=ko.observable(0);self.balance_float=ko.observable();self.balance_unconfirmed=ko.observable(0);self.avghashrate=ko.observable({h1:"",h3:"",h6:"",h12:"",h24:""});self.avghashratetooltip=ko.observable("");self.last_reported_hashrate=ko.observable(0);self.workers=ko.observableArray([]);self.workers.extend({rateLimit:250});self.sharerates=ko.observableArray([]);self.min_payout=ko.observable(0);self.message_db=ko.observable("");self.zec_alert=ko.observable("");self.calc=ko.observable(new Calc);self.badPrefix=ko.observable("");self.badPID=ko.observable("");self.badWorkerName=ko.observable("");self.payments=ko.observable(new Payments);self.altpayments=ko.observable(new Payments);self._exchangeWallet=false;self.loading_json_data_modal=ko.observable(true);self.jsondatahtml=ko.observable(new UserData);self.json_data_modal_Visible=ko.observable(false);self.settings_loading_modal=ko.observable(true);self.settings_modal_visible=ko.observable(false);self.workers_avg_loading=ko.observable(true);self.unconfirmedTooltip=ko.observable("<div style='text-align: center'>"+"Confirmation "+config.blockConfirmation+" blocks (~ "+config.blockConfirmationTime+")"+"</div>");self.balance_alert_text=ko.computed(function(){if(self.min_payout()===undefined||self.min_payout()===null||self.min_payout()===0||self.balance_float()===undefined||self.min_payout()<self.balance_float())return"";else return"Minimum payout is "+self.min_payout()+" "+config.shortNameUpper},this)};AccountViewModel.prototype.checkAddress=function(addr){var self=this;if(config.shortName==="pasc"){var valid=/^\d+$/.test(addr)||/^\d+-\d{2}$/.test(addr);if(!valid){self.badPrefix("Address must contain only digits.")}}if(config.shortName==="zec"){if(addr.indexOf("t")!==0)self.badPrefix("Address must start from 't' symbol.");request("/address/validate/"+self._originAddress,30,function(data){if(!data)self.badPrefix("Your address is invalid. Please, contact support.")})}};AccountViewModel.prototype.checkPID=function(addr,pid){var self=this;if(config.shortName==="pasc"&&addr==="86646"){var valid=/^[0-9a-f]{16}$/.test(pid);if(!valid){self.badPID("Payment ID must contain only hex characters.")}}};AccountViewModel.prototype.replaceAddressByExchange=function(){var self=this;if(config.hasPaymentID!==undefined&&config.hasPaymentID){var addressParts=self._address.split(".");self._address=addressParts[0];self.checkAddress(self._address);self._paymentID=undefined;if(addressParts.length>1){self._paymentID=addressParts[1];self.checkPID(self._address,self._paymentID)}if(exchanges.hasOwnProperty(config.shortName)){var ex=exchanges[config.shortName];ex.forEach(function(exchange){if(exchange.address===self._address){self._address=exchange.name;self._exchangeWallet=true}})}}else{self.checkAddress(self._address)}};AccountViewModel.prototype.checkWrongLengthAddress=function(){var self=this;self.addressLengths=ko.observableArray(config.addressLength);var wrongLength=true;if(self.addressLengths()!==undefined&&!self._exchangeWallet&&self.addressLengths().length>0){for(var i=0;i<self.addressLengths().length;i++)if(self._address.length===self.addressLengths()[i]){wrongLength=false;break}}else{wrongLength=false}self.wrongLength=ko.observable(wrongLength);if(self.wrongLength()){var rightLengths=self.addressLengths()[0];for(var i=1;i<self.addressLengths().length;i++)rightLengths=rightLengths+" or "+self.addressLengths()[i];self.wrongLengthText=ko.observable("Address length must be "+rightLengths+" characters. Your address contains "+self.address().length+" characters. Please, contact support at "+config.mail)}else{self.wrongLengthText=ko.observable("")}if(config.shortName==="xmr"&&self._paymentID!==undefined&&self._paymentID.length!==64){self.wrongLengthPaymentID=ko.observable("Payment-ID length must be 64 characters. Your payment-ID contains "+self._paymentID.length+" characters.")}else{self.wrongLengthPaymentID=ko.observable("")}};AccountViewModel.prototype.showUserData=function(){var self=this;self.json_data_modal_Visible(true);request("/user/"+self._originAddress,300,function(data){self.jsondatahtml().text(syntaxHighlight(JSON.stringify(data,undefined,4)));self.loading_json_data_modal(false)})};AccountViewModel.prototype.showUserSettings=function(){var self=this;self.settings_modal_visible(true);self.settings_loading_modal(false)};AccountViewModel.prototype.ok=function(){var self=this;self.modalVisible(false)};AccountViewModel.prototype.switch_offline_workers=function(){var self=this;self.show_offline_workers(!self.show_offline_workers())};AccountViewModel.prototype.loadMessage=function(){var self=this;request("/message/"+self._originAddress,30,function(data){if(data!==undefined&&data!==null&&data!==""){self.message_db(data)}})};AccountViewModel.prototype.loadHashrateBalance=function(callback){var self=this;request("/balance_hashrate/"+self._originAddress,30,function(data){var chart=$("#hr_chart").highcharts();if(chart!==undefined)chart.reflow();if(!self.workerPage())self.hashrate(new BigNumber(data.hashrate).toFormat(config.hashratePrecision));var b=parseFloat(data.balance);self.balance_float(b);self.balance(new BigNumber(Math.max(0,b)).toFormat(config.coinSigns));callback()})};AccountViewModel.prototype.loadWorkerHashrate=function(){var self=this;if(self.workerPage()){request("/hashrate/"+self._originAddress+self._workerUrl,30,function(data){self.hashrate(new BigNumber(data).toFormat(config.hashratePrecision))})}};AccountViewModel.prototype.loadUnconfirmedBalance=function(){var self=this;if(config.hasUnconfirmedBalance){request("/balance_unconfirmed/"+self._originAddress,30,function(data){self.balance_unconfirmed(new BigNumber(Math.max(0,parseFloat(data))).toFormat(config.coinSigns))})}};AccountViewModel.prototype.loadAverageHashrate=function(callback){var self=this;request("/avghashrate/"+self._originAddress+self._workerUrl,60,function(data){self.avghashrate({h1:new BigNumber(data.h1).toFormat(config.hashratePrecision),h3:new BigNumber(data.h3).toFormat(config.hashratePrecision),h6:new BigNumber(data.h6).toFormat(config.hashratePrecision),h12:new BigNumber(data.h12).toFormat(config.hashratePrecision),h24:new BigNumber(data.h24).toFormat(config.hashratePrecision)});self.avghashratetooltip("<div style='text-align: center'>"+"Calculated average hashrate<br>"+"1 hour:&nbsp&nbsp&nbsp&nbsp"+self.avghashrate().h1+" "+config.hashrateUnits+" <br>"+"3 hours:&nbsp&nbsp&nbsp"+self.avghashrate().h3+" "+config.hashrateUnits+" <br>"+"6 hours:&nbsp&nbsp&nbsp"+self.avghashrate().h6+" "+config.hashrateUnits+" <br>"+"12 hours:&nbsp"+self.avghashrate().h12+" "+config.hashrateUnits+" <br>"+"24 hours:&nbsp"+self.avghashrate().h24+" "+config.hashrateUnits+" <br>"+"</div>");callback()})};AccountViewModel.prototype.loadApproximatedEarnings=function(){var self=this;request("/approximated_earnings/"+self.avghashrate().h6.replaceAll(",",""),60,function(data){if(data===null)return;self.calc().setValues(data)})};AccountViewModel.prototype.loadReportedHashrate=function(){var self=this;if(config.hasReportedHashrate){var _url="/reportedhashrate/"+self._originAddress;if(self.workerPage()){_url=_url+self._workerUrl}request(_url,60,function(data){if(data!==null)self.last_reported_hashrate(new BigNumber(data).toFormat(config.hashratePrecision))})}};AccountViewModel.prototype.loadWorkers=function(callback){var self=this;if(!self.workerPage()){request("/workers/"+self._originAddress,60,function(data){var workers=[];if(data===undefined||data.length===0){return}var dtNow=new Date;var dtNow=new Date;data.forEach(function(w){var worker=clone(w);if(new Date(worker.lastShare).getTime()===0){worker.last_share_is_old=true;worker.last_share="unknown"}else{var agoMinutes=(dtNow-new Date(worker.lastShare*1e3))/6e4;if(agoMinutes<10){worker.last_share="several minutes ago"}else{if(agoMinutes<5)worker.last_share="few minutes ago";else worker.last_share=moment.unix(worker.lastShare).fromNow()}worker.last_share_is_old=agoMinutes>30}workers.push({id:worker.id,hashrate:worker.hashrate,last_share:worker.last_share,last_share_is_old:worker.last_share_is_old,rating:worker.rating})});var tmp=workers.slice();for(var workerKey in tmp){if(tmp[workerKey].last_share_is_old){var w=tmp[workerKey];var idx=workers.indexOf(w);if(idx>=0){workers.splice(idx,1);workers.push(w)}}}workers.forEach(function(worker){var w=self.workers().objectByProp("id",worker.id);if(w===null)self.workers.push(new Worker(worker.id,worker.hashrate,worker.last_share,worker.last_share_is_old,worker.rating));else{w.hashrate(worker.hashrate);w.last_share_is_old(worker.last_share_is_old);w.last_share(worker.last_share);w.rating(worker.rating)}});self.workers.sort(function(a,b){if(a.last_share_is_old())return 1;if(b.last_share_is_old())return-1;return alphanum(a.id,b.id)});callback()})}else{callback()}};AccountViewModel.prototype.loadAverageHashrateWorkers=function(){var self=this;return;request("/avghashrateworkers/"+self._originAddress+"/6",60,function(data){if(data===undefined||data.length===0){self.workers_avg_loading(false);return}var workers=[];data.forEach(function(worker){workers.push({id:worker.worker,avgHashrate:worker.hashrate})});workers.forEach(function(worker){var w=self.workers().objectByProp("id",worker.id);if(w!==null){w.avg_hashrate(new BigNumber(worker.avgHashrate).toFormat(config.hashratePrecision))}});self.workers_avg_loading(false)})};AccountViewModel.prototype.loadReportedHashrateWorkers=function(){var self=this;if(config.hasReportedHashrate){request("/reportedhashrates/"+self._originAddress,60,function(data){if(data===undefined||data.length===0){return}var workers=[];data.forEach(function(worker){workers.push({id:worker.worker,reported_hashrate:worker.hashrate})});workers.forEach(function(worker){var w=self.workers().objectByProp("id",worker.id);if(w!==null)w.reported_hashrate(new BigNumber(worker.reported_hashrate).toFormat(config.hashratePrecision))})})}};AccountViewModel.prototype.loadShareRateHistory=function(){var self=this;request("/shareratehistory/"+self._originAddress+self._workerUrl,60,function(data){if(data===undefined||data.length===0)return;var groupedShareRates=[];var lastHour=0;var sum=0;data.sort(function(a,b){return a.date-b.date});var startTime;var endTime;for(var key in data){if(data[key].date===undefined)continue;var dt=data[key].date;var hour=Math.floor(dt/3600);if(hour!=lastHour){if(lastHour!==0){var e=moment(endTime).format("MMM Do HH:mm:ss");var ago=moment(endTime).fromNow();groupedShareRates.push({date:e+" ("+ago+")",amount:sum})}sum=data[key].shares;lastHour=hour;startTime=new Date(dt*1e3);endTime=new Date(dt*1e3);startTime.setMinutes(0,0);endTime.setMinutes(59,59)}else{sum+=data[key].shares}}if(Math.floor(endTime.getTime()/36e5)===Math.floor((new Date).getTime()/36e5))groupedShareRates.push({date:"Current hour",amount:sum});else{var e=moment(endTime).format("MMM Do HH:mm:ss");var ago=moment(endTime).fromNow();groupedShareRates.push({date:e+" ("+ago+")",amount:sum});groupedShareRates.push({date:"Current hour",amount:0})}groupedShareRates.reverse();self.sharerates(groupedShareRates)})};AccountViewModel.prototype.loadPayments=function(){var self=this;if(!self.workerPage()){request("/payments/count/"+self._originAddress,60,function(data){if(data===undefined||data.count===undefined||data.count===0)return;self.payments().total_paid(parseFloat(data.sum));self.payments().totalPayments(parseFloat(data.count));ko.computed(function(){var offset=(self.payments().currentPage()-1)*self.payments().numPerPage();var limit=self.payments().numPerPage();request("/payments/"+self._originAddress+"/"+offset+"/"+limit,60,function(data){if(data===undefined||data.count===0)return;var arr=[];data.forEach(function(p){var unixDate=p.date;var date=moment.unix(unixDate).format("YYYY-MM-DD HH:mm:ss");var amount=parseFloat(p.amount);var payment=new Payment(p.txHash,date,amount,p.confirmed,null);arr.push(payment)});self.payments().payments(arr)})})})}};AccountViewModel.prototype.loadAltPayments=function(){var self=this;if(!self.workerPage()&&(config.hasAltPayments!==undefined&&config.hasAltPayments)){request("/altpayments/count/"+self._originAddress,60,function(data){if(data===undefined||data.count===undefined||data.count===0)return;self.altpayments().total_paid(parseFloat(data.sum));self.altpayments().totalPayments(parseFloat(data.count));var i=0;ko.computed(function(){var begin=(self.altpayments().currentPage()-1)*self.altpayments().numPerPage();request("/altpayments/"+self._originAddress+"/"+begin+"/"+self.altpayments().numPerPage(),60,function(data){if(data===undefined||data.count===0)return;var arr=[];data.forEach(function(p){var unixDate=p.date;var date=moment.unix(unixDate).format("YYYY-MM-DD HH:mm:ss");var amount=parseFloat(p.amount);var payment=new Payment(p.txHash,date,amount,p.confirmed,p.extra);arr.push(payment)});self.altpayments().payments(arr)})})})}};function AccountViewModel(){var self=this;self.init();self.parseAddress();self.replaceAddressByExchange();self.paymentID=ko.observable(self._paymentID===undefined?"":self._paymentID);self.address=ko.observable(self._address);self.originAddress=ko.observable(self._originAddress);self.checkWrongLengthAddress();self.usersettings=ko.observable(new UserSettings(self.originAddress(),self));if(config.shortNameUpper==="ZEC"&&self.originAddress().indexOf("t")!==0)self.zec_alert("Only public addresses (t-addr) are supported now.");getUserSettings(self._originAddress,function(min_payout,pubkey){self.min_payout(min_payout);self.usersettings().current_min_payout(self.min_payout());self.usersettings().current_pubkey(pubkey);self.loadMessage();self.loadHashrateBalance(function(){self.loadWorkerHashrate();self.loadUnconfirmedBalance();self.loadAverageHashrate(function(){self.loadApproximatedEarnings()});self.loadReportedHashrate();self.loadWorkers(function(){self.loadAverageHashrateWorkers();self.loadReportedHashrateWorkers()});self.loadShareRateHistory();self.loadPayments();self.loadAltPayments()})})}waitConfig(function(){ko.applyBindings(new AccountViewModel);$(function(){$('[data-toggle="tooltip"]').tooltip()})});
//# sourceMappingURL=account.min.map